# Categorizer API

## Table of Contents
<!--ts-->
   * [Purpose](#purpose)
   * [Setting Up](#setting-up)
      * [Technology Stack](#technology-stack)
      * [Deploy](#deploy)
   * [Getting Started](#getting-started)
      * [Endpoints](#endpoints)
      * [DataBase](#database)
      * [Monitoring](#monitoring)
      * [Contact](#contact)
<!--te-->

---

## Purpose
*This is a Spring Boot demo project.* 

The application classifies items into categories-subcategories pairs trough REST endpoints, and store them on an in-memory relational DB.

Only the categories stored in the DB are consider valid, the applications initialize with the following categories stored:

|Category   |
|--------   |
|PERSON     |
|PLACE      |
|ANIMAL     |
|COMPUTER   |
|OTHER      |

If you try to add the following categories-subcategory pairs, as an example:

|Category   |Subcategory|
|--------   |-----------|
|PERSON	    |Bob Jones  |
|PLACE	    |Washington |
|PERSON	    |Mary       |
|COMPUTER	|Mac        |
|PERSON	    |Bob Jones  |
|OTHER	    |Tree       |
|ANIMAL	    |Dog        |
|PLACE	    |Texas      |
|FOOD	    |Steak      |
|ANIMAL	    |Cat        |
|PERSON	    |Mac        |

Then the duplicates are not be considered as well pairs with invalid categories. 
The data is stored on the DB in the same order that was provided.
The order is maintained over time by the autogenerated Id in the relational DB.

In this example, the result of the operation is:

|ID |Category   |Subcategory|
|---|--------   |-----------|
| 1 |PERSON	    |Bob Jones  |
| 2 |PLACE	    |Washington |
| 3 |PERSON	    |Mary       |
| 4 |COMPUTER	|Mac        |
| 5 |OTHER	    |Tree       |
| 6 |ANIMAL	    |Dog        |
| 7 |PLACE	    |Texas      |
| 8 |ANIMAL	    |Cat        |
| 9 |PERSON	    |Mac        |

After processing the data, the output shows the category subcategory pairs, sorted in ascending order.
Also, the count of valid entries for each category is shown afterward.

|Category   |Subcategory|
|--------   |-----------|
|PERSON	    |Bob Jones  |
|ANIMAL	    |Cat        |
|ANIMAL	    |Dog        |
|COMPUTER	|Mac        |
|PERSON	    |Mac        | 
|PERSON	    |Mary       |
|PLACE	    |Texas      |
|OTHER	    |Tree       |
|PLACE	    |Washington |

|Category|Count|
|--------|----:|
|ANIMAL  |    2|
|COMPUTER|    1|
|OTHER   |    1|
|PERSON  |    3|
|PLACE   |    2|

---

## Setting Up
What we need for local Development.

### Technology Stack
- Java 14
- Spring Boot 2.2.7
- Maven 3.6.1

### Deploy
One of the benefits of Sprint Boot is that it comes with an embedded web server.
Using the Maven build provided by the Spring Boot Initialzr, you'll get a `.jar` file inside the `/target` directory.
You can use the `.jar` file to run the entire Spring application.

```shell script
# generates categorizer-0.0.1-SNAPSHOT.jar
mvn clean install

# runs the application using the embedded web server.
java -jar target/categorizer-0.0.1-SNAPSHOT.jar
```

---

## Getting Started
How can we use it

### Endpoints
The REST service provides eight endpoints; each one of them uses `JSON` format to work with the data.
I'm using `GET`, `POST`, and `DELETE` for listing, add, and remove, respectively.
You can work with individual items, or a list of them for add or remove.

In the root path, I provide JSON files to show the format of the body:
- [Single category](category.json)
- [List of categories](categories.json)
- [Single subcategory](subcategory.json)
- [List of subcategories](subcategories.json)

Next, I'm listing shell commands to call the endpoints after you start the application from the current path.

#### Category management
- list categories trough GET
```shell script
curl -X GET http://localhost:8080/categories
```
- add category trough POST
```shell script
curl -v -X POST -H 'Content-Type: application/json' http://localhost:8080/category -d '{"category":"FOOD"}'
```
- add categories trough POST
```shell script
curl -v -X POST -H 'Content-Type: application/json' http://localhost:8080/categories -d '[{"category":"ANIMAL"},{"category":"COMPUTER"},{"category":"OTHER"},{"category":"PERSON"},{"category":"PLACE"}]'
```
- remove category trough DELETE
```shell script
curl -X DELETE -H 'Content-Type: application/json' http://localhost:8080/category -d '{"category":"FOOD"}'
```
- remove categories trough DELETE
```shell script
curl -X DELETE -H 'Content-Type: application/json' http://localhost:8080/categories -d '[{"category":"ANIMAL"},{"category":"COMPUTER"},{"category":"OTHER"},{"category":"PERSON"},{"category":"PLACE"},{"category":"FOOD"}]'
```

#### Subcategory management
- list subcategories trough GET
```shell script
curl -X GET http://localhost:8080/subcategories
```
- add subcategory trough POST
```shell script
curl -X POST -H 'Content-Type: application/json' http://localhost:8080/subcategory -d '{"category":"PERSON","subcategory":"Gerardo Cortes"}'
```
- add subcategories trough POST
```shell script
curl -X POST -H 'Content-Type: application/json' http://localhost:8080/subcategories -d '[{"category":"PERSON","subcategory":"Bob Jones"},{"category":"PLACE","subcategory":"Washington"},{"category":"PERSON","subcategory":"Mary"},{"category":"COMPUTER","subcategory":"Mac"},{"category":"PERSON","subcategory":"Bob Jones"},{"category":"OTHER","subcategory":"Tree"},{"category":"ANIMAL","subcategory":"Dog"},{"category":"PLACE","subcategory":"Texas"},{"category":"FOOD","subcategory":"Steak"},{"category":"ANIMAL","subcategory":"Cat"},{"category":"PERSON","subcategory":"Mac"}]'
```

### DataBase
I'm using an in-memory relational database, `H2` allows watching it's content on the browser once the application is running.
http://localhost:8080/h2-console

You need to use this URL to connect
```
jdbc:h2:mem:testdb
```

### Monitoring
Spring Boot Actuator allows you to monitor the applications by providing production-ready features like health check-up, metrics gathering, etc.
All of these features can be accessed over JMX or HTTP endpoints.

The health endpoint provides basic information about the application’s health.

http://localhost:8080/actuator/health

The metrics endpoint just lists the metrics that are currently collected.

http://localhost:8080/actuator/metrics

The prometheus endpoint exposes metrics data in a format that can be scraped by a Prometheus server.

http://localhost:8080/actuator/prometheus

## Contact
[Gerardo Cortés Oquendo](mailto:gerardo.cortes.o@gmail.com)
